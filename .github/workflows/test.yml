name: test
on:
  workflow_call:
    inputs:
      node-version:
        type: string
        required: false
        default: '20.x'
      runs-on:
        type: string
        required: false
        default: 'ubuntu-latest'
      no-lockfile:
        type: string
        required: false
        default: 'false'
      only-integration-tests:
        type: string
        required: false
        default: 'false'

jobs:
  test:
    name: "${{inputs.only-integration-tests =='true' && 'Integration' || 'All'}} Tests [Node.js ${{ inputs.node-version }}, ${{ inputs.runs-on }}, ${{ inputs.no-lockfile == 'false' && 'Using yarn.lock' || 'Ignoring yarn.lock' }}]"
    runs-on: ${{ inputs.runs-on }}
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/yarn-install
        with:
          node-version: ${{ inputs.node-version }}
          no-lockfile: ${{ inputs.no-lockfile }}
      - name: Run Jest Tests
        run: yarn jest ${{inputs.only-integration-tests == 'true'  && '"integration"' || ''}} --ci --maxWorkers 4 --reporters=default --reporters=jest-junit --rootdir='./'
