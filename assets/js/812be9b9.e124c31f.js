"use strict";(self.webpackChunkmetro_website=self.webpackChunkmetro_website||[]).push([[599],{3905:(e,a,t)=>{t.r(a),t.d(a,{MDXContext:()=>d,MDXProvider:()=>x,mdx:()=>f,useMDXComponents:()=>p,withMDXComponents:()=>s});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(){return o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o.apply(this,arguments)}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=n.createContext({}),s=function(e){return function(a){var t=p(a.components);return n.createElement(e,o({},a,{components:t}))}},p=function(e){var a=n.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):m(m({},a),e)),t},x=function(e){var a=p(e.components);return n.createElement(d.Provider,{value:a},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},h=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),s=p(t),x=r,u=s["".concat(l,".").concat(x)]||s[x]||c[x]||o;return t?n.createElement(u,m(m({ref:a},d),{},{components:t})):n.createElement(u,m({ref:a},d))}));function f(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=h;var m={};for(var i in a)hasOwnProperty.call(a,i)&&(m[i]=a[i]);m.originalType=e,m[u]="string"==typeof e?e:r,l[1]=m;for(var d=2;d<o;d++)l[d]=t[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},65087:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>m,metadata:()=>d,toc:()=>p});var n=t(83117),r=t(80102),o=(t(67294),t(3905)),l=["components"],m={id:"resolution",title:"Module Resolution"},i=void 0,d={unversionedId:"resolution",id:"resolution",title:"Module Resolution",description:"Module resolution is the process of translating module names to module paths at build time. For example, if your project contains the code:",source:"@site/../docs/Resolution.md",sourceDirName:".",slug:"/resolution",permalink:"/metro/docs/resolution",draft:!1,editUrl:"https://github.com/facebook/metro/edit/main/docs/../docs/Resolution.md",tags:[],version:"current",lastUpdatedAt:1696273341,formattedLastUpdatedAt:"Oct 2, 2023",frontMatter:{id:"resolution",title:"Module Resolution"},sidebar:"docs",previous:{title:"Caching",permalink:"/metro/docs/caching"},next:{title:"Source Map Format",permalink:"/metro/docs/source-map-format"}},s={},p=[{value:"Resolution algorithm",id:"resolution-algorithm",level:2},{value:"Resolution types",id:"resolution-types",level:3},{value:"Source file",id:"source-file",level:4},{value:"Asset files",id:"asset-files",level:4},{value:"Empty module",id:"empty-module",level:4},{value:"Algorithm",id:"algorithm",level:3},{value:"RESOLVE",id:"resolve",level:4},{value:"RESOLVE_MODULE",id:"resolve_module",level:4},{value:"RESOLVE_PACKAGE",id:"resolve_package",level:4},{value:"RESOLVE_PACKAGE_EXPORTS",id:"resolve_package_exports",level:4},{value:"RESOLVE_FILE",id:"resolve_file",level:4},{value:"RESOLVE_ASSET",id:"resolve_asset",level:4},{value:"RESOLVE_HASTE",id:"resolve_haste",level:4},{value:"Resolution context",id:"resolution-context",level:3},{value:"<code>assetExts: $ReadOnlySet&lt;string&gt;</code>",id:"assetexts-readonlysetstring",level:4},{value:"<code>doesFileExist: string =&gt; boolean</code>",id:"doesfileexist-string--boolean",level:4},{value:"<code>nodeModulesPaths: $ReadOnlyArray&lt;string&gt;</code>",id:"nodemodulespaths-readonlyarraystring",level:4},{value:"<code>preferNativePlatform: boolean</code>",id:"prefernativeplatform-boolean",level:4},{value:"<code>redirectModulePath: string =&gt; string | false</code>",id:"redirectmodulepath-string--string--false",level:4},{value:"<code>resolveAsset: (dirPath: string, assetName: string, extension: string) =&gt; ?$ReadOnlyArray&lt;string&gt;</code>",id:"resolveasset-dirpath-string-assetname-string-extension-string--readonlyarraystring",level:4},{value:"<code>sourceExts: $ReadOnlyArray&lt;string&gt;</code>",id:"sourceexts-readonlyarraystring",level:4},{value:"<code>mainFields: $ReadOnlyArray&lt;string&gt;</code>",id:"mainfields-readonlyarraystring",level:4},{value:"<code>getPackage: string =&gt; PackageJson</code>",id:"getpackage-string--packagejson",level:4},{value:'<code>getPackageForModule: (modulePath: string) =&gt; ?PackageInfo</code> <div class="label deprecated">Deprecated</div>',id:"getpackageformodule-modulepath-string--packageinfo-deprecated",level:4},{value:"<code>resolveHasteModule: string =&gt; ?string</code>",id:"resolvehastemodule-string--string",level:4},{value:"<code>resolveHastePackage: string =&gt; ?string</code>",id:"resolvehastepackage-string--string",level:4},{value:"<code>allowHaste: boolean</code>",id:"allowhaste-boolean",level:4},{value:"<code>disableHierarchicalLookup: boolean</code>",id:"disablehierarchicallookup-boolean",level:4},{value:"<code>extraNodeModules: ?{[string]: string}</code>",id:"extranodemodules-string-string",level:4},{value:"<code>originModulePath: string</code>",id:"originmodulepath-string",level:4},{value:"<code>customResolverOptions: {[string]: mixed}</code>",id:"customresolveroptions-string-mixed",level:4},{value:"<code>resolveRequest: CustomResolver</code>",id:"resolverequest-customresolver",level:4},{value:"<code>dependency: ?Dependency</code>",id:"dependency-dependency",level:4},{value:"Caching",id:"caching",level:2}],x={toc:p},u="wrapper";function c(e){var a=e.components,t=(0,r.Z)(e,l);return(0,o.mdx)(u,(0,n.Z)({},x,t,{components:a,mdxType:"MDXLayout"}),(0,o.mdx)("p",null,"Module resolution is the process of translating module names to module paths at build time. For example, if your project contains the code:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"// src/App.js\nimport {View} from 'react-native';\n// ...\n")),(0,o.mdx)("p",null,"Metro needs to know where in your project to load the ",(0,o.mdx)("inlineCode",{parentName:"p"},"react-native")," module from. This will typically resolve to something like ",(0,o.mdx)("inlineCode",{parentName:"p"},"node_modules/react-native/index.js"),"."),(0,o.mdx)("p",null,"Likewise, if your project contains the (similar) code:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"// src/App.js\nimport Comp from './Component';\n// ...\n")),(0,o.mdx)("p",null,"Metro needs to understand that you are referring to, say, ",(0,o.mdx)("inlineCode",{parentName:"p"},"src/Component.js"),", and not another file named ",(0,o.mdx)("inlineCode",{parentName:"p"},"Component")," that may also exist elsewhere."),(0,o.mdx)("p",null,"Metro implements a version of ",(0,o.mdx)("a",{parentName:"p",href:"https://nodejs.org/api/modules.html#loading-from-node_modules-folders"},"Node's module resolution algorithm"),", augmented with additional Metro-specific features."),(0,o.mdx)("p",null,"These Metro-specific features include:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},"Haste"),": An opt-in mechanism for importing modules by their globally-unique name anywhere in the project, e.g. ",(0,o.mdx)("inlineCode",{parentName:"li"},"import Foo from 'Foo'"),"."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},"Platform extensions"),": Used by ",(0,o.mdx)("a",{parentName:"li",href:"https://reactnative.dev/docs/platform-specific-code#platform-specific-extensions"},"React Native")," to allow developers to write platform-specific versions of their JavaScript modules."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},"Asset extensions and image resolutions"),": Used by ",(0,o.mdx)("a",{parentName:"li",href:"https://reactnative.dev/docs/images#static-image-resources"},"React Native")," to automatically select the best version of an image asset based on the device's screen density at runtime."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},"Custom resolvers"),": Metro integrators can provide their own resolver implementations to override almost everything about how modules are resolved.")),(0,o.mdx)("h2",{id:"resolution-algorithm"},"Resolution algorithm"),(0,o.mdx)("p",null,"Given a ",(0,o.mdx)("a",{parentName:"p",href:"#resolution-context"},"resolution context")," ",(0,o.mdx)("em",{parentName:"p"},"context"),", a module name ",(0,o.mdx)("em",{parentName:"p"},"moduleName"),", and an optional platform identifier ",(0,o.mdx)("em",{parentName:"p"},"platform"),", Metro's resolver performs ",(0,o.mdx)("a",{parentName:"p",href:"#resolve"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE")),"(",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"moduleName"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),"), which either returns one of the ",(0,o.mdx)("a",{parentName:"p",href:"#resolution-types"},"resolution types"),", or throws an error."),(0,o.mdx)("h3",{id:"resolution-types"},"Resolution types"),(0,o.mdx)("h4",{id:"source-file"},"Source file"),(0,o.mdx)("p",null,"The request is resolved to some absolute path representing a physical file on disk."),(0,o.mdx)("h4",{id:"asset-files"},"Asset files"),(0,o.mdx)("p",null,"The request is resolved to one or more absolute paths representing physical files on disk."),(0,o.mdx)("h4",{id:"empty-module"},"Empty module"),(0,o.mdx)("p",null,"The request is resolved to a built-in empty module, namely the one specified in ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#emptymodulepath"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.emptyModulePath")),"."),(0,o.mdx)("h3",{id:"algorithm"},"Algorithm"),(0,o.mdx)("admonition",{type:"note"},(0,o.mdx)("p",{parentName:"admonition"},"These are the rules that Metro's default resolver follows. Refer to ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/facebook/metro/blob/main/packages/metro-resolver/src/resolve.js"},(0,o.mdx)("inlineCode",{parentName:"a"},"metro-resolver"),"'s source code")," for more details.")),(0,o.mdx)("h4",{id:"resolve"},"RESOLVE"),(0,o.mdx)("p",null,"Parameters: (",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"moduleName"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),")"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"If a ",(0,o.mdx)("a",{parentName:"li",href:"#resolverequest-customresolver"},"custom resolver")," is defined, then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Return the result of the custom resolver."))),(0,o.mdx)("li",{parentName:"ol"},"Otherwise, attempt to resolve ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," as a path",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Let ",(0,o.mdx)("em",{parentName:"li"},"absoluteModuleName")," be the result of prepending the current directory (i.e. parent of ",(0,o.mdx)("a",{parentName:"li",href:"#originmodulepath-string"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.originModulePath")),") with ",(0,o.mdx)("em",{parentName:"li"},"moduleName"),"."),(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_module"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_MODULE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"absoluteModuleName"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),"), or continue."))),(0,o.mdx)("li",{parentName:"ol"},"Apply ",(0,o.mdx)("a",{parentName:"li",href:"#redirectmodulepath-string--string--false"},"redirections")," to ",(0,o.mdx)("em",{parentName:"li"},"moduleName"),". If this results in an ",(0,o.mdx)("a",{parentName:"li",href:"#empty-module"},"empty module"),", then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Return the empty module."))),(0,o.mdx)("li",{parentName:"ol"},"If ",(0,o.mdx)("a",{parentName:"li",href:"#allowhaste-boolean"},"Haste resolutions are allowed"),", then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Get the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_haste"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_HASTE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"moduleName"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),")."),(0,o.mdx)("li",{parentName:"ol"},"If resolved as a Haste package path, then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Perform the algorithm for resolving a path (step 2 above). Throw an error if this resolution fails.\nFor example, if the Haste package path for ",(0,o.mdx)("inlineCode",{parentName:"li"},"'a/b'")," is ",(0,o.mdx)("inlineCode",{parentName:"li"},"foo/package.json"),", perform step 2 as if ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," was ",(0,o.mdx)("inlineCode",{parentName:"li"},"foo/c"),"."))))),(0,o.mdx)("li",{parentName:"ol"},"If ",(0,o.mdx)("a",{parentName:"li",href:"#disableHierarchicalLookup-boolean"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.disableHierarchicalLookup"))," is not ",(0,o.mdx)("inlineCode",{parentName:"li"},"true"),", then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Try resolving ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," under ",(0,o.mdx)("inlineCode",{parentName:"li"},"node_modules")," from the current directory (i.e. parent of ",(0,o.mdx)("a",{parentName:"li",href:"#originmodulepath-string"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.originModulePath")),") up to the root directory."),(0,o.mdx)("li",{parentName:"ol"},"Perform ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_package"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_PACKAGE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"modulePath"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),") for each candidate path."))),(0,o.mdx)("li",{parentName:"ol"},"For each element ",(0,o.mdx)("em",{parentName:"li"},"nodeModulesPath")," of ",(0,o.mdx)("a",{parentName:"li",href:"#nodemodulespaths-readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.nodeModulesPaths")),":",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Try resolving ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," under ",(0,o.mdx)("em",{parentName:"li"},"nodeModulesPath")," as if the latter was another ",(0,o.mdx)("inlineCode",{parentName:"li"},"node_modules")," directory (similar to step 5 above)."),(0,o.mdx)("li",{parentName:"ol"},"Perform ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_package"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_PACKAGE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"modulePath"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),") for each candidate path."))),(0,o.mdx)("li",{parentName:"ol"},"If ",(0,o.mdx)("a",{parentName:"li",href:"#extranodemodules-string-string"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.extraNodeModules"))," is set:",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Split ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," into a package name (including an optional ",(0,o.mdx)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/v8/using-npm/scope"},"scope"),") and relative path."),(0,o.mdx)("li",{parentName:"ol"},"Look up the package name in ",(0,o.mdx)("a",{parentName:"li",href:"#extranodemodules-string-string"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.extraNodeModules")),". If found, then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Construct a path ",(0,o.mdx)("em",{parentName:"li"},"modulePath")," by replacing the package name part of ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," with the value found in ",(0,o.mdx)("a",{parentName:"li",href:"#extranodemodules-string-string"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.extraNodeModules"))),(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_package"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_PACKAGE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"modulePath"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),")."))))),(0,o.mdx)("li",{parentName:"ol"},"If no valid resolution has been found, throw a resolution failure error.")),(0,o.mdx)("h4",{id:"resolve_module"},"RESOLVE_MODULE"),(0,o.mdx)("p",null,"Parameters: (",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"moduleName"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),")"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Let ",(0,o.mdx)("em",{parentName:"li"},"filePath")," be the result of applying ",(0,o.mdx)("a",{parentName:"li",href:"#redirectmodulepath-string--string--false"},"redirections")," to ",(0,o.mdx)("em",{parentName:"li"},"moduleName"),". This may locate a replacement subpath from a containing ",(0,o.mdx)("inlineCode",{parentName:"li"},"package.json")," file based on the ",(0,o.mdx)("a",{parentName:"li",href:"https://github.com/defunctzombie/package-browser-field-spec"},(0,o.mdx)("inlineCode",{parentName:"a"},"browser")," field spec"),"."),(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_file"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_FILE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"filePath"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),"), or continue."),(0,o.mdx)("li",{parentName:"ol"},"Otherwise, let ",(0,o.mdx)("em",{parentName:"li"},"dirPath")," be the directory path of ",(0,o.mdx)("em",{parentName:"li"},"filePath"),"."),(0,o.mdx)("li",{parentName:"ol"},"If a file ",(0,o.mdx)("em",{parentName:"li"},"dirPath")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'package.json'")," exists, resolve based on the ",(0,o.mdx)("a",{parentName:"li",href:"https://github.com/defunctzombie/package-browser-field-spec"},(0,o.mdx)("inlineCode",{parentName:"a"},"browser")," field spec"),":",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Let ",(0,o.mdx)("em",{parentName:"li"},"mainModulePath")," be the result of reading the package's entry path using ",(0,o.mdx)("a",{parentName:"li",href:"#mainfields-readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.mainFields")),"."),(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_file"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_FILE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"mainModulePath"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),"), or continue."),(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_file"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_FILE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"mainModulePath")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'/index'"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),")."),(0,o.mdx)("li",{parentName:"ol"},"Throw an error if no resolution could be found.")))),(0,o.mdx)("h4",{id:"resolve_package"},"RESOLVE_PACKAGE"),(0,o.mdx)("p",null,"Parameters: (",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"moduleName"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),")"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"If ",(0,o.mdx)("inlineCode",{parentName:"li"},"context.enablePackageExports")," is enabled, and a containing ",(0,o.mdx)("inlineCode",{parentName:"li"},"package.json")," file contains the field ",(0,o.mdx)("inlineCode",{parentName:"li"},'"exports"'),", get result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_package-exports"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_PACKAGE_EXPORTS")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"packagePath"),", ",(0,o.mdx)("em",{parentName:"li"},"filePath"),", ",(0,o.mdx)("em",{parentName:"li"},"exportsField"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),").",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"If resolved path exists, return result."),(0,o.mdx)("li",{parentName:"ol"},"Else, log either a package configuration or package encapsulation warning."))),(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_module"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_MODULE")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"filePath"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),").")),(0,o.mdx)("h4",{id:"resolve_package_exports"},"RESOLVE_PACKAGE_EXPORTS"),(0,o.mdx)("p",null,"Parameters: (",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"packagePath"),", ",(0,o.mdx)("em",{parentName:"p"},"filePath"),", ",(0,o.mdx)("em",{parentName:"p"},"exportsField"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),")"),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},"Resolves a package subpath based on the ",(0,o.mdx)("a",{parentName:"p",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#package-entry-points"},"Package Entry Points spec")," (the ",(0,o.mdx)("inlineCode",{parentName:"p"},'"exports"')," field), when ",(0,o.mdx)("a",{parentName:"p",href:"./configuration#unstable_enablepackageexports-experimental"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.unstable_enablePackageExports"))," is enabled.")),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Let ",(0,o.mdx)("em",{parentName:"li"},"subpath")," be the relative path from ",(0,o.mdx)("em",{parentName:"li"},"packagePath")," to ",(0,o.mdx)("em",{parentName:"li"},"filePath"),", or ",(0,o.mdx)("inlineCode",{parentName:"li"},"'.'"),"."),(0,o.mdx)("li",{parentName:"ol"},"If ",(0,o.mdx)("em",{parentName:"li"},"exportsField")," contains an invalid configuration or values, raise an ",(0,o.mdx)("inlineCode",{parentName:"li"},"InvalidPackageConfigurationError"),"."),(0,o.mdx)("li",{parentName:"ol"},"If ",(0,o.mdx)("em",{parentName:"li"},"subpath")," is not defined by ",(0,o.mdx)("em",{parentName:"li"},"exportsField"),", raise a ",(0,o.mdx)("inlineCode",{parentName:"li"},"PackagePathNotExportedError"),"."),(0,o.mdx)("li",{parentName:"ol"},"Let ",(0,o.mdx)("em",{parentName:"li"},"target")," be the result of matching ",(0,o.mdx)("em",{parentName:"li"},"subpath")," in ",(0,o.mdx)("em",{parentName:"li"},"exportsField")," after applying any ",(0,o.mdx)("a",{parentName:"li",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#conditional-exports"},"conditional exports")," and/or substituting a ",(0,o.mdx)("a",{parentName:"li",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#subpath-patterns"},"subpath pattern match"),".",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Condition names will be asserted from the union of ",(0,o.mdx)("inlineCode",{parentName:"li"},"context.unstable_conditionNames")," and ",(0,o.mdx)("inlineCode",{parentName:"li"},"context.unstable_conditionNamesByPlatform")," for ",(0,o.mdx)("em",{parentName:"li"},"platform"),", in the order defined by ",(0,o.mdx)("em",{parentName:"li"},"exportsField"),"."))),(0,o.mdx)("li",{parentName:"ol"},"If ",(0,o.mdx)("em",{parentName:"li"},"target")," refers to an ",(0,o.mdx)("a",{parentName:"li",href:"#assetexts-readonlysetstring"},"asset"),", then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_asset"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_ASSET")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"target"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),")."))),(0,o.mdx)("li",{parentName:"ol"},"Return ",(0,o.mdx)("em",{parentName:"li"},"target")," as a ",(0,o.mdx)("a",{parentName:"li",href:"#source-file"},"source file resolution")," ",(0,o.mdx)("strong",{parentName:"li"},"without")," applying redirections or trying any platform or extension variants.")),(0,o.mdx)("h4",{id:"resolve_file"},"RESOLVE_FILE"),(0,o.mdx)("p",null,"Parameters: (",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"filePath"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),")"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"If the path refers to an ",(0,o.mdx)("a",{parentName:"li",href:"#assetexts-readonlysetstring"},"asset"),", then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Return the result of ",(0,o.mdx)("a",{parentName:"li",href:"#resolve_asset"},(0,o.mdx)("strong",{parentName:"a"},"RESOLVE_ASSET")),"(",(0,o.mdx)("em",{parentName:"li"},"context"),", ",(0,o.mdx)("em",{parentName:"li"},"filePath"),", ",(0,o.mdx)("em",{parentName:"li"},"platform"),")."))),(0,o.mdx)("li",{parentName:"ol"},"Otherwise, if the path ",(0,o.mdx)("a",{parentName:"li",href:"#doesfileexist-string--boolean"},"exists"),", then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Try all platform and extension variants in sequence. Return a ",(0,o.mdx)("a",{parentName:"li",href:"#source-file"},"source file resolution")," for the first one that ",(0,o.mdx)("a",{parentName:"li",href:"#doesfileexist-string--boolean"},"exists")," after applying ",(0,o.mdx)("a",{parentName:"li",href:"#redirectmodulepath-string--string--false"},"redirections"),". For example, if ",(0,o.mdx)("em",{parentName:"li"},"platform")," is ",(0,o.mdx)("inlineCode",{parentName:"li"},"android")," and ",(0,o.mdx)("a",{parentName:"li",href:"#sourceexts-readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.sourceExts"))," is ",(0,o.mdx)("inlineCode",{parentName:"li"},"['js', 'jsx']"),", try this sequence of potential file names:",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("em",{parentName:"li"},"moduleName")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'.android.js'")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("em",{parentName:"li"},"moduleName")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'.native.js'")," (if ",(0,o.mdx)("a",{parentName:"li",href:"#prefernativeplatform-boolean"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.preferNativePlatform"))," is ",(0,o.mdx)("inlineCode",{parentName:"li"},"true"),")"),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("em",{parentName:"li"},"moduleName")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'.js'")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("em",{parentName:"li"},"moduleName")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'.android.jsx'")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("em",{parentName:"li"},"moduleName")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'.native.jsx'")," (if ",(0,o.mdx)("a",{parentName:"li",href:"#prefernativeplatform-boolean"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.preferNativePlatform"))," is ",(0,o.mdx)("inlineCode",{parentName:"li"},"true"),")"),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("em",{parentName:"li"},"moduleName")," + ",(0,o.mdx)("inlineCode",{parentName:"li"},"'.jsx'"))))))),(0,o.mdx)("h4",{id:"resolve_asset"},"RESOLVE_ASSET"),(0,o.mdx)("p",null,"Parameters: (",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"filePath"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),")"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Use ",(0,o.mdx)("a",{parentName:"li",href:"#resolveasset-dirpath-string-assetname-string-extension-string--readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"a"},"context.resolveAsset"))," to collect all asset variants."),(0,o.mdx)("li",{parentName:"ol"},"Return an ",(0,o.mdx)("a",{parentName:"li",href:"#asset-files"},"asset resolution")," containing the collected asset paths.")),(0,o.mdx)("h4",{id:"resolve_haste"},"RESOLVE_HASTE"),(0,o.mdx)("p",null,"Parameters: (",(0,o.mdx)("em",{parentName:"p"},"context"),", ",(0,o.mdx)("em",{parentName:"p"},"moduleName"),", ",(0,o.mdx)("em",{parentName:"p"},"platform"),")"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Try resolving ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," as a ",(0,o.mdx)("a",{parentName:"li",href:"#resolvehastemodule-string--string"},"Haste module"),".\nIf found, then",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},"Return result as a ",(0,o.mdx)("a",{parentName:"li",href:"#source-file"},"source file resolution")," ",(0,o.mdx)("strong",{parentName:"li"},"without")," applying redirections or trying any platform or extension variants."))),(0,o.mdx)("li",{parentName:"ol"},"Try resolving ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," as a ",(0,o.mdx)("a",{parentName:"li",href:"#resolvehastepackage-string--string"},"Haste (global) package"),", or a path ",(0,o.mdx)("em",{parentName:"li"},"relative")," to a Haste package.\nFor example, if ",(0,o.mdx)("em",{parentName:"li"},"moduleName")," is ",(0,o.mdx)("inlineCode",{parentName:"li"},"'a/b/c'"),", try the following potential Haste package names:",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("inlineCode",{parentName:"li"},"'a/b/c'"),", relative path ",(0,o.mdx)("inlineCode",{parentName:"li"},"''")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("inlineCode",{parentName:"li"},"'a/b'"),", relative path ",(0,o.mdx)("inlineCode",{parentName:"li"},"'./c'")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("inlineCode",{parentName:"li"},"'a'"),", with relative path ",(0,o.mdx)("inlineCode",{parentName:"li"},"'./b/c'"))))),(0,o.mdx)("h3",{id:"resolution-context"},"Resolution context"),(0,o.mdx)("h4",{id:"assetexts-readonlysetstring"},(0,o.mdx)("inlineCode",{parentName:"h4"},"assetExts: $ReadOnlySet<string>")),(0,o.mdx)("p",null,"The set of file extensions used to identify asset files. Defaults to ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#assetexts"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.assetExts")),"."),(0,o.mdx)("h4",{id:"doesfileexist-string--boolean"},(0,o.mdx)("inlineCode",{parentName:"h4"},"doesFileExist: string => boolean")),(0,o.mdx)("p",null,"Returns ",(0,o.mdx)("inlineCode",{parentName:"p"},"true")," if the file with the given path exists, or ",(0,o.mdx)("inlineCode",{parentName:"p"},"false")," otherwise."),(0,o.mdx)("p",null,"By default, Metro implements this by consulting an in-memory map of the filesystem that has been prepared in advance. This approach avoids disk I/O during module resolution."),(0,o.mdx)("h4",{id:"nodemodulespaths-readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"h4"},"nodeModulesPaths: $ReadOnlyArray<string>")),(0,o.mdx)("p",null,"A list of paths to check for modules after looking through all ",(0,o.mdx)("inlineCode",{parentName:"p"},"node_modules")," directories."),(0,o.mdx)("p",null,"By default this is set to ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#nodemodulespaths"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.nodeModulesPaths"))),(0,o.mdx)("h4",{id:"prefernativeplatform-boolean"},(0,o.mdx)("inlineCode",{parentName:"h4"},"preferNativePlatform: boolean")),(0,o.mdx)("p",null,"If ",(0,o.mdx)("inlineCode",{parentName:"p"},"true"),", try ",(0,o.mdx)("inlineCode",{parentName:"p"},".native.${ext}")," before ",(0,o.mdx)("inlineCode",{parentName:"p"},".${ext}")," and after ",(0,o.mdx)("inlineCode",{parentName:"p"},".${platform}.${ext}")," during resolution. Metro sets this to ",(0,o.mdx)("inlineCode",{parentName:"p"},"true"),"."),(0,o.mdx)("h4",{id:"redirectmodulepath-string--string--false"},(0,o.mdx)("inlineCode",{parentName:"h4"},"redirectModulePath: string => string | false")),(0,o.mdx)("p",null,"Rewrites a module path, or returns ",(0,o.mdx)("inlineCode",{parentName:"p"},"false")," to redirect to the special ",(0,o.mdx)("a",{parentName:"p",href:"#empty-module"},"empty module"),". In the default resolver, the resolution algorithm terminates with an ",(0,o.mdx)("a",{parentName:"p",href:"#empty-module"},"empty module result")," if ",(0,o.mdx)("inlineCode",{parentName:"p"},"redirectModulePath")," returns ",(0,o.mdx)("inlineCode",{parentName:"p"},"false"),"."),(0,o.mdx)("p",null,"Metro uses this to implement the ",(0,o.mdx)("inlineCode",{parentName:"p"},"package.json")," ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/defunctzombie/package-browser-field-spec"},(0,o.mdx)("inlineCode",{parentName:"a"},"browser")," field spec"),", particularly the ability to ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/defunctzombie/package-browser-field-spec#replace-specific-files---advanced"},"replace")," and ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/defunctzombie/package-browser-field-spec#ignore-a-module"},"ignore")," specific files."),(0,o.mdx)("p",null,"The default implementation of this function respects ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#resolvermainfields"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.resolverMainFields")),"."),(0,o.mdx)("h4",{id:"resolveasset-dirpath-string-assetname-string-extension-string--readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"h4"},"resolveAsset: (dirPath: string, assetName: string, extension: string) => ?$ReadOnlyArray<string>")),(0,o.mdx)("p",null,"Given a directory path, the base asset name and an extension, returns a list of all the asset file names that match the given base name in that directory, or ",(0,o.mdx)("inlineCode",{parentName:"p"},"null")," if no such files are found. The default implementation considers each of ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#assetresolutions"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.assetResolutions"))," and uses the ",(0,o.mdx)("inlineCode",{parentName:"p"},"${assetName}@${resolution}${extension}")," format for asset variant file names."),(0,o.mdx)("p",null,"See also ",(0,o.mdx)("a",{parentName:"p",href:"https://reactnative.dev/docs/images#static-image-resources"},"Static Image Resources")," in the React Native docs."),(0,o.mdx)("h4",{id:"sourceexts-readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"h4"},"sourceExts: $ReadOnlyArray<string>")),(0,o.mdx)("p",null,"The list of file extensions to try, in order, when resolving a module path that does not exist on disk. Defaults to ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#sourceexts"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.sourceExts")),"."),(0,o.mdx)("h4",{id:"mainfields-readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"h4"},"mainFields: $ReadOnlyArray<string>")),(0,o.mdx)("p",null,"The ordered list of fields in ",(0,o.mdx)("inlineCode",{parentName:"p"},"package.json")," that should be read to resolve a package's main entry point (and any subpath file replacements) per the ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/defunctzombie/package-browser-field-spec"},'"browser" field spec'),". Defaults to ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#resolvermainfields"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.resolverMainFields")),"."),(0,o.mdx)("h4",{id:"getpackage-string--packagejson"},(0,o.mdx)("inlineCode",{parentName:"h4"},"getPackage: string => PackageJson")),(0,o.mdx)("p",null,"Given the path to a ",(0,o.mdx)("inlineCode",{parentName:"p"},"package.json")," file, returns the parsed file contents."),(0,o.mdx)("h4",{id:"getpackageformodule-modulepath-string--packageinfo-deprecated"},(0,o.mdx)("inlineCode",{parentName:"h4"},"getPackageForModule: (modulePath: string) => ?PackageInfo")," ",(0,o.mdx)("div",{class:"label deprecated"},"Deprecated")),(0,o.mdx)("p",null,"Given a module path that may exist under an npm package, locates and returns the package root path and parsed ",(0,o.mdx)("inlineCode",{parentName:"p"},"package.json")," contents."),(0,o.mdx)("h4",{id:"resolvehastemodule-string--string"},(0,o.mdx)("inlineCode",{parentName:"h4"},"resolveHasteModule: string => ?string")),(0,o.mdx)("p",null,"Resolves a Haste module name to an absolute path. Returns ",(0,o.mdx)("inlineCode",{parentName:"p"},"null")," if no such module exists."),(0,o.mdx)("p",null,"The default implementation of this function uses ",(0,o.mdx)("a",{parentName:"p",href:"https://www.npmjs.com/package/metro-file-map"},"metro-file-map"),"'s ",(0,o.mdx)("inlineCode",{parentName:"p"},"getModule")," method."),(0,o.mdx)("h4",{id:"resolvehastepackage-string--string"},(0,o.mdx)("inlineCode",{parentName:"h4"},"resolveHastePackage: string => ?string")),(0,o.mdx)("p",null,"Resolves a Haste (global) package name to an absolute ",(0,o.mdx)("inlineCode",{parentName:"p"},"package.json")," path. Returns ",(0,o.mdx)("inlineCode",{parentName:"p"},"null")," if no such package exists."),(0,o.mdx)("p",null,"The default implementation of this function uses ",(0,o.mdx)("a",{parentName:"p",href:"https://www.npmjs.com/package/metro-file-map"},"metro-file-map"),"'s ",(0,o.mdx)("inlineCode",{parentName:"p"},"getPackage")," method and can be turned on or off using ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#enableglobalpackages"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.enableGlobalPackages")),"."),(0,o.mdx)("h4",{id:"allowhaste-boolean"},(0,o.mdx)("inlineCode",{parentName:"h4"},"allowHaste: boolean")),(0,o.mdx)("p",null,(0,o.mdx)("inlineCode",{parentName:"p"},"true")," if Haste resolutions are allowed in the current context, ",(0,o.mdx)("inlineCode",{parentName:"p"},"false")," otherwise."),(0,o.mdx)("h4",{id:"disablehierarchicallookup-boolean"},(0,o.mdx)("inlineCode",{parentName:"h4"},"disableHierarchicalLookup: boolean")),(0,o.mdx)("p",null,"If ",(0,o.mdx)("inlineCode",{parentName:"p"},"true"),", the resolver should not perform lookup in ",(0,o.mdx)("inlineCode",{parentName:"p"},"node_modules")," directories per the Node resolution algorithm. Defaults to ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#disablehierarchicallookup"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.disableHierarchicalLookup")),"."),(0,o.mdx)("h4",{id:"extranodemodules-string-string"},(0,o.mdx)("inlineCode",{parentName:"h4"},"extraNodeModules: ?{[string]: string}")),(0,o.mdx)("p",null,"A mapping of package names to directories that is consulted after the standard lookup through ",(0,o.mdx)("inlineCode",{parentName:"p"},"node_modules")," as well as any ",(0,o.mdx)("a",{parentName:"p",href:"#nodemodulespaths-readonlyarraystring"},(0,o.mdx)("inlineCode",{parentName:"a"},"nodeModulesPaths")),"."),(0,o.mdx)("h4",{id:"originmodulepath-string"},(0,o.mdx)("inlineCode",{parentName:"h4"},"originModulePath: string")),(0,o.mdx)("p",null,"The path to the current module, e.g. the one containing the ",(0,o.mdx)("inlineCode",{parentName:"p"},"import")," we are currently resolving."),(0,o.mdx)("h4",{id:"customresolveroptions-string-mixed"},(0,o.mdx)("inlineCode",{parentName:"h4"},"customResolverOptions: {[string]: mixed}")),(0,o.mdx)("p",null,"Any custom options passed to the resolver. By default, Metro populates this based on URL parameters in the bundle request, e.g. ",(0,o.mdx)("inlineCode",{parentName:"p"},"http://localhost:8081/index.bundle?resolver.key=value")," becomes ",(0,o.mdx)("inlineCode",{parentName:"p"},"{key: 'value'}"),"."),(0,o.mdx)("h4",{id:"resolverequest-customresolver"},(0,o.mdx)("inlineCode",{parentName:"h4"},"resolveRequest: CustomResolver")),(0,o.mdx)("p",null,"A alternative resolver function to which the current request may be delegated. Defaults to ",(0,o.mdx)("a",{parentName:"p",href:"/metro/docs/configuration#resolvereqeuest"},(0,o.mdx)("inlineCode",{parentName:"a"},"resolver.resolveRequest")),"."),(0,o.mdx)("p",null,"Metro expects ",(0,o.mdx)("inlineCode",{parentName:"p"},"resolveRequest")," to have the following signature:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-flow"},"function resolveRequest(\n  context: ResolutionContext,\n  moduleName: string,\n  platform: string | null,\n): Resolution {\n  // ...\n}\n\ntype Resolution =\n  | {type: 'empty'}\n  | {type: 'sourceFile', filePath: string}\n  | {type: 'assetFiles', filePaths: $ReadOnlyArray<string>};\n")),(0,o.mdx)("p",null,"When calling the default resolver with a non-null ",(0,o.mdx)("inlineCode",{parentName:"p"},"resolveRequest")," function, it represents a custom resolver and will always be called, fully replacing the default resolution logic."),(0,o.mdx)("p",null,"Inside a custom resolver, ",(0,o.mdx)("inlineCode",{parentName:"p"},"resolveRequest")," is set to the default resolver function, for easy chaining and customization."),(0,o.mdx)("h4",{id:"dependency-dependency"},(0,o.mdx)("inlineCode",{parentName:"h4"},"dependency: ?Dependency")),(0,o.mdx)("p",null,"A dependency descriptor corresponding to the current resolution request. This is provided for diagnostic purposes ",(0,o.mdx)("em",{parentName:"p"},"only")," and may not be used for semantic purposes. See the ",(0,o.mdx)("a",{parentName:"p",href:"#caching"},"Caching")," section for more information."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-flow"},"type Dependency = {\n  // The literal name provided to a require or import call. For example 'foo' in\n  // case of `require('foo')`.\n  name: string,\n\n  data: {\n    // A locally unique key for this dependency within the origin module.\n    key: string,\n\n    // Source locations from the Babel AST, relative to the origin module, where\n    // this dependency was encountered. This may be an empty array.\n    locs: $ReadOnlyArray<BabelSourceLocation>,\n\n    asyncType: 'async' | 'prefetch' | 'weak' | null,\n\n    // Other properties are considered internal and may change in the future.\n    ...\n  },\n};\n")),(0,o.mdx)("h2",{id:"caching"},"Caching"),(0,o.mdx)("p",null,"Resolver results may be cached under the following conditions:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"For given origin module paths ",(0,o.mdx)("em",{parentName:"li"},"A")," and ",(0,o.mdx)("em",{parentName:"li"},"B")," and target module name ",(0,o.mdx)("em",{parentName:"li"},"M"),", the resolution for ",(0,o.mdx)("em",{parentName:"li"},"M")," may be reused if ",(0,o.mdx)("strong",{parentName:"li"},"all")," of the following conditions hold:",(0,o.mdx)("ol",{parentName:"li"},(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("em",{parentName:"li"},"A")," and ",(0,o.mdx)("em",{parentName:"li"},"B")," are in the same directory."),(0,o.mdx)("li",{parentName:"ol"},"The contents of ",(0,o.mdx)("a",{parentName:"li",href:"#customresolveroptions-string-mixed"},(0,o.mdx)("inlineCode",{parentName:"a"},"customResolverOptions"))," are equivalent ( = serialize to JSON the same) in both calls to the resolver."))),(0,o.mdx)("li",{parentName:"ol"},"Any cache of resolutions must be invalidated if any file in the project has changed.")),(0,o.mdx)("p",null,"Custom resolvers must adhere to these assumptions, e.g. they may not return different resolutions for origin modules in the same directory under the same ",(0,o.mdx)("inlineCode",{parentName:"p"},"customResolverOptions"),"."))}c.isMDXComponent=!0}}]);