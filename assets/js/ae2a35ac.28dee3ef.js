"use strict";(self.webpackChunkmetro_website=self.webpackChunkmetro_website||[]).push([[708],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>l,MDXProvider:()=>c,mdx:()=>h,useMDXComponents:()=>m,withMDXComponents:()=>d});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),d=function(e){return function(t){var n=m(t.components);return a.createElement(e,i({},t,{components:n}))}},m=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=m(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",x={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),d=m(n),c=o,u=d["".concat(r,".").concat(c)]||d[c]||x[c]||i;return n?a.createElement(u,s(s({ref:t},l),{},{components:n})):a.createElement(u,s({ref:t},l))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=g;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[u]="string"==typeof e?e:o,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},72722:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>x,frontMatter:()=>s,metadata:()=>l,toc:()=>m});var a=n(83117),o=n(80102),i=(n(67294),n(3905)),r=["components"],s={id:"package-exports",title:"Package Exports Support (Experimental)"},p=void 0,l={unversionedId:"package-exports",id:"package-exports",title:"Package Exports Support (Experimental)",description:"Background",source:"@site/../docs/PackageExports.md",sourceDirName:".",slug:"/package-exports",permalink:"/docs/package-exports",draft:!1,editUrl:"https://github.com/facebook/metro/edit/main/docs/../docs/PackageExports.md",tags:[],version:"current",lastUpdatedAt:1702906651,formattedLastUpdatedAt:"Dec 18, 2023",frontMatter:{id:"package-exports",title:"Package Exports Support (Experimental)"},sidebar:"docs",previous:{title:"Metro CLI Options",permalink:"/docs/cli"},next:{title:"Troubleshooting",permalink:"/docs/troubleshooting"}},d={},m=[{value:"Background",id:"background",level:2},{value:"Configuration options",id:"configuration-options",level:2},{value:"Summary of breaking changes",id:"summary-of-breaking-changes",level:2},{value:"Breaking: Match <code>&quot;exports&quot;</code> first, then fall back to legacy resolution",id:"breaking-match-exports-first-then-fall-back-to-legacy-resolution",level:3},{value:"Example",id:"example",level:4},{value:"Breaking: Import specifiers are matched exactly",id:"breaking-import-specifiers-are-matched-exactly",level:3},{value:"Example",id:"example-1",level:4},{value:"Package encapsulation is lenient",id:"package-encapsulation-is-lenient",level:3},{value:"Migration guide for package maintainers",id:"migration-guide-for-package-maintainers",level:2},{value:"Recommended: Introducing <code>&quot;exports&quot;</code> is a breaking change",id:"recommended-introducing-exports-is-a-breaking-change",level:3},{value:"Package subpaths",id:"package-subpaths",level:3},{value:"File extensions are important!",id:"file-extensions-are-important",level:4},{value:"Subpath patterns do not permit expansion",id:"subpath-patterns-do-not-permit-expansion",level:4},{value:"Replacing <code>&quot;browser&quot;</code> and <code>&quot;react-native&quot;</code> fields",id:"replacing-browser-and-react-native-fields",level:3},{value:"Example: Use conditional exports to target web and React Native",id:"example-use-conditional-exports-to-target-web-and-react-native",level:4},{value:"Replacing platform-specific extensions",id:"replacing-platform-specific-extensions",level:3},{value:"Use <code>Platform.select()</code> (React Native)",id:"use-platformselect-react-native",level:4},{value:"Asset files",id:"asset-files",level:3}],c={toc:m},u="wrapper";function x(e){var t=e.components,n=(0,o.Z)(e,r);return(0,i.mdx)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.mdx)("h2",{id:"background"},"Background"),(0,i.mdx)("p",null,"Introduced in Node.js 12.7.0, Package Exports is a modern approach for npm packages to specify ",(0,i.mdx)("strong",{parentName:"p"},"entry points")," \u2014 the mapping of package subpaths which can be externally imported and which file(s) they should resolve to."),(0,i.mdx)("p",null,"When Package Exports support is enabled via ",(0,i.mdx)("a",{parentName:"p",href:"/docs/configuration/#unstable_enablepackageexports-experimental"},(0,i.mdx)("inlineCode",{parentName:"a"},"resolver.unstable_enablePackageExports")),", Metro's ",(0,i.mdx)("a",{parentName:"p",href:"/docs/resolution#algorithm"},"module resolution algorithm")," will consider the ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," field in ",(0,i.mdx)("inlineCode",{parentName:"p"},"package.json")," files."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#package-entry-points"},"Node.js spec")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"https://github.com/react-native-community/discussions-and-proposals/blob/main/proposals/0534-metro-package-exports-support.md"},"RFC for Package Exports in Metro")),(0,i.mdx)("li",{parentName:"ul"},"React Native announcement post (coming soon!)")),(0,i.mdx)("h2",{id:"configuration-options"},"Configuration options"),(0,i.mdx)("table",null,(0,i.mdx)("thead",{parentName:"table"},(0,i.mdx)("tr",{parentName:"thead"},(0,i.mdx)("th",{parentName:"tr",align:null},"Option"),(0,i.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,i.mdx)("tbody",{parentName:"table"},(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"/docs/configuration/#unstable_enablepackageexports-experimental"},(0,i.mdx)("inlineCode",{parentName:"a"},"resolver.unstable_enablePackageExports"))),(0,i.mdx)("td",{parentName:"tr",align:null},"Enable Package Exports support.")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"/docs/configuration/#unstable_conditionnames-experimental"},(0,i.mdx)("inlineCode",{parentName:"a"},"resolver.unstable_conditionNames"))),(0,i.mdx)("td",{parentName:"tr",align:null},"The set of condition names to assert when resolving conditional exports.")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"/docs/configuration/#unstable_conditionsbyplatform-experimental"},(0,i.mdx)("inlineCode",{parentName:"a"},"resolver.unstable_conditionsByPlatform"))),(0,i.mdx)("td",{parentName:"tr",align:null},"The additional condition names to assert when resolving for a given platform target.")))),(0,i.mdx)("h2",{id:"summary-of-breaking-changes"},"Summary of breaking changes"),(0,i.mdx)("admonition",{type:"info"},(0,i.mdx)("p",{parentName:"admonition"},(0,i.mdx)("strong",{parentName:"p"},"Package Exports resolution is available since Metro 0.76.1 and is disabled by default"),". We will provide the option to disable it for a long time yet, and have no plans to remove existing non-",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," resolution behaviour.")),(0,i.mdx)("p",null,"Since Package Exports features overlap with existing React Native concepts (such as ",(0,i.mdx)("a",{parentName:"p",href:"https://reactnative.dev/docs/platform-specific-code"},"platform-specific extensions"),"), and since ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," had been live in the npm ecosystem for some time, we reached out to the React Native community to make sure our implementation would meet developers' needs (",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/react-native-community/discussions-and-proposals/pull/534"},"PR"),", ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/react-native-community/discussions-and-proposals/blob/main/proposals/0534-metro-package-exports-support.md"},"final RFC"),")."),(0,i.mdx)("p",null,"This led us to create an implementation of Package Exports in Metro that is spec-compliant (necessitating some breaking changes), but backwards compatible otherwise (helping apps with existing imports to migrate gradually)."),(0,i.mdx)("h3",{id:"breaking-match-exports-first-then-fall-back-to-legacy-resolution"},"Breaking: Match ",(0,i.mdx)("inlineCode",{parentName:"h3"},'"exports"')," first, then fall back to legacy resolution"),(0,i.mdx)("p",null,"If present in a ",(0,i.mdx)("inlineCode",{parentName:"p"},"package.json")," file, ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," will be the first field consulted when resolving a package."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},'"exports"')," will be used instead of any existing ",(0,i.mdx)("inlineCode",{parentName:"li"},'"react-native"'),", ",(0,i.mdx)("inlineCode",{parentName:"li"},'"browser"'),", or ",(0,i.mdx)("inlineCode",{parentName:"li"},'"main"')," field \u2014\xa0or a file on disk at the same subpath (edge case)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("strong",{parentName:"li"},"Fallback"),": If the requested subpath is not matched in ",(0,i.mdx)("inlineCode",{parentName:"li"},'"exports"'),", Metro will try to resolve it again, considering the above fields.")),(0,i.mdx)("p",null,"Subpaths matched in ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," (including via ",(0,i.mdx)("a",{parentName:"p",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#subpath-patterns"},"subpath patterns"),") will use the exact target file path specified by a package."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Metro will not expand ",(0,i.mdx)("a",{parentName:"li",href:"/docs/configuration/#sourceexts"},(0,i.mdx)("inlineCode",{parentName:"a"},"sourceExts"))," against the import specifier."),(0,i.mdx)("li",{parentName:"ul"},"Metro will not resolve ",(0,i.mdx)("a",{parentName:"li",href:"https://reactnative.dev/docs/platform-specific-code"},"platform-specific extensions")," against the target file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("strong",{parentName:"li"},"Unchanged"),": Metro will expand ",(0,i.mdx)("a",{parentName:"li",href:"/docs/configuration#assetresolutions"},"asset densities")," (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"icon.png")," \u2192 ",(0,i.mdx)("inlineCode",{parentName:"li"},"icon@2x.png"),") if the target file ",(0,i.mdx)("a",{parentName:"li",href:"/docs/configuration/#assetexts"},"is an asset"),".")),(0,i.mdx)("h4",{id:"example"},"Example"),(0,i.mdx)("p",null,"For a package without an ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," field, Metro tries multiple potential file locations based on the import specifier:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"import FooComponent from 'some-pkg/FooComponent';\n// Tries .[platform].js, .native.js, .js (+ TypeScript variants)\n")),(0,i.mdx)("p",null,"However, if ",(0,i.mdx)("inlineCode",{parentName:"p"},'"./FooComponent"')," is listed in ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"'),", Metro matches the import specifier to this subpath, and uses the target file specified by the package with no further rules:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"import FooComponent from 'some-pkg/FooComponent';\n// Resolves exact target from \"exports\" only\n")),(0,i.mdx)("admonition",{type:"note"},(0,i.mdx)("p",{parentName:"admonition"},"We have no plans to drop platform-specific extensions for packages not using ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"'),", or in app code.")),(0,i.mdx)("h3",{id:"breaking-import-specifiers-are-matched-exactly"},"Breaking: Import specifiers are matched exactly"),(0,i.mdx)("p",null,"Previously, import specifiers (the string given to ",(0,i.mdx)("inlineCode",{parentName:"p"},"import")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"require()"),") could be defined using both extensioned or extensionless paths. This is no longer the case for subpath keys in the ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," field."),(0,i.mdx)("h4",{id:"example-1"},"Example"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "some-pkg",\n  "exports": {\n    "./FooComponent": "./src/FooComponent.js"\n  }\n}\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},'import FooComponent from \'some-pkg/FooComponent.js\';\n// Inaccessible unless the package had also listed "./FooComponent.js"\n// as an "exports" key\n')),(0,i.mdx)("p",null,"Note that this behaviour also applies for subpath patterns: ",(0,i.mdx)("inlineCode",{parentName:"p"},'"./*": "./src/*.js"')," is distinct from ",(0,i.mdx)("inlineCode",{parentName:"p"},'"./*.js": "./src/*.js"'),"."),(0,i.mdx)("h3",{id:"package-encapsulation-is-lenient"},"Package encapsulation is lenient"),(0,i.mdx)("p",null,"In Node.js, it is an error to import package subpaths that aren't explicitly listed in ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"'),". In Metro, we've decided to handle these errors leniently and resolve modules following the old behavior as necessary. This is intended to reduce user friction for previously allowed imports in existing Metro projects."),(0,i.mdx)("p",null,"Instead of throwing an error, Metro will log a warning and fall back to file-based resolution."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-sh"},'warn: You have imported the module "foo/private/fn.js" which is not listed in\nthe "exports" of "foo". Consider updating your call site or asking the package\nmaintainer(s) to expose this API.\n')),(0,i.mdx)("admonition",{type:"note"},(0,i.mdx)("p",{parentName:"admonition"},"We plan to implement a strict mode for package encapsulation in future, to align with Node's default behavior. ",(0,i.mdx)("strong",{parentName:"p"},"We recommend that all developers fix encapsulation warnings in their code"),".")),(0,i.mdx)("h2",{id:"migration-guide-for-package-maintainers"},"Migration guide for package maintainers"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Adding an ",(0,i.mdx)("inlineCode",{parentName:"strong"},'"exports"')," field to your package is entirely optional"),". Existing package resolution features will behave identically for packages which don't use ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," \u2014 and we have no plans to remove this behaviour."),(0,i.mdx)("h3",{id:"recommended-introducing-exports-is-a-breaking-change"},"Recommended: Introducing ",(0,i.mdx)("inlineCode",{parentName:"h3"},'"exports"')," is a breaking change"),(0,i.mdx)("p",null,"The Node.js spec gives guidance on migrating to ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," in a non-breaking manner, however this is challenging in practice. For instance, if your React Native package uses ",(0,i.mdx)("a",{parentName:"p",href:"https://reactnative.dev/docs/platform-specific-code"},"platform-specific extensions")," on its public exports, this is a breaking change by default."),(0,i.mdx)("blockquote",null,(0,i.mdx)("p",{parentName:"blockquote"},"To make the introduction of ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," non-breaking, ensure that every previously supported entry point is exported. It is best to explicitly specify entry points so that the package's public API is well-defined."),(0,i.mdx)("p",{parentName:"blockquote"},"\u2014\xa0",(0,i.mdx)("a",{parentName:"p",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#package-entry-points"},"https://nodejs.org/docs/latest-v19.x/api/packages.html#package-entry-points"))),(0,i.mdx)("h3",{id:"package-subpaths"},"Package subpaths"),(0,i.mdx)("admonition",{type:"caution"},(0,i.mdx)("p",{parentName:"admonition"},(0,i.mdx)("strong",{parentName:"p"},"Please do not rely on ",(0,i.mdx)("a",{parentName:"strong",href:"#package-encapsulation-is-lenient"},"lenient package encapsulation")," under Metro.")," While Metro does this for backwards compatibility, packages should follow how ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," is documented in the spec and strictly implemented by other tools.")),(0,i.mdx)("h4",{id:"file-extensions-are-important"},"File extensions are important!"),(0,i.mdx)("p",null,"Each subpath is an exact specifier (",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/react-native-community/discussions-and-proposals/blob/main/proposals/0534-metro-package-exports-support.md#exact-path-specifiers"},"see section in RFC"),")."),(0,i.mdx)("p",null,"We recommend continuing to use ",(0,i.mdx)("strong",{parentName:"p"},"extensionless specifiers")," for subpaths in packages targeting React Native \u2014\xa0or ",(0,i.mdx)("strong",{parentName:"p"},"defining both extensioned and extensionless specifiers"),". This will match matching existing user expectations."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'  "exports": {\n    ".": "./src/index.js",\n    "./FooComponent": "./src/FooComponent.js",\n    "./FooComponent.js": "./src/FooComponent.js"\n  }\n')),(0,i.mdx)("h4",{id:"subpath-patterns-do-not-permit-expansion"},"Subpath patterns do not permit expansion"),(0,i.mdx)("p",null,"Subpath patterns are a shorthand for mapping multiple subpaths \u2014\xa0they do not permit path expansion (strictly a substring replacement), however will match nested directories (",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/react-native-community/discussions-and-proposals/blob/main/proposals/0534-metro-package-exports-support.md#subpath-patterns"},"see section in RFC"),")."),(0,i.mdx)("p",null,"Only one ",(0,i.mdx)("inlineCode",{parentName:"p"},"*")," is permitted per side of a subpath pattern."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'  "exports": {\n    ".": "./index.js",\n    "./utils/*": "./utils/*.js"\n  }\n')),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"'pkg/utils/foo'")," matches ",(0,i.mdx)("inlineCode",{parentName:"li"},"'pkg/utils/foo.js'"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"'pkg/utils/foo/bar'")," matches ",(0,i.mdx)("inlineCode",{parentName:"li"},"'pkg/utils/foo/bar.js'"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"'pkg/utils/foo'")," ",(0,i.mdx)("strong",{parentName:"li"},"does not match")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"'pkg/utils/foo.bar.js'"),".")),(0,i.mdx)("h3",{id:"replacing-browser-and-react-native-fields"},"Replacing ",(0,i.mdx)("inlineCode",{parentName:"h3"},'"browser"')," and ",(0,i.mdx)("inlineCode",{parentName:"h3"},'"react-native"')," fields"),(0,i.mdx)("p",null,"We've introduced ",(0,i.mdx)("inlineCode",{parentName:"p"},'"react-native"')," as a community condition (for use with conditional exports). This represents React Native, the framework, sitting alongside other recognised runtimes such as ",(0,i.mdx)("inlineCode",{parentName:"p"},'"node"')," and ",(0,i.mdx)("inlineCode",{parentName:"p"},'"deno"')," (",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/nodejs/node/pull/45367"},"RFC"),")."),(0,i.mdx)("blockquote",null,(0,i.mdx)("p",{parentName:"blockquote"},(0,i.mdx)("a",{parentName:"p",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#community-conditions-definitions"},"Community Conditions Definitions \u2014\xa0",(0,i.mdx)("strong",{parentName:"a"},(0,i.mdx)("inlineCode",{parentName:"strong"},'"react-native"')))),(0,i.mdx)("p",{parentName:"blockquote"},(0,i.mdx)("em",{parentName:"p"},'Will be matched by the React Native framework (all platforms). To target React Native for Web, "browser" should be specified before this condition.'))),(0,i.mdx)("p",null,"This replaces the previous ",(0,i.mdx)("inlineCode",{parentName:"p"},'"react-native"')," root field. The priority order for how this was previously resolved was determined by projects, ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/expo/router/issues/37#issuecomment-1275925758"},"which created ambiguity when using React Native for Web"),". Under ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"'),", ",(0,i.mdx)("em",{parentName:"p"},"packages concretely define the resolution order for conditional entry points")," \u2014\xa0removing this ambiguity."),(0,i.mdx)("h4",{id:"example-use-conditional-exports-to-target-web-and-react-native"},"Example: Use conditional exports to target web and React Native"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'  "exports": {\n    "browser": "./dist/index-browser.js",\n    "react-native": "./dist/index-react-native.js",\n    "default": "./dist/index.js"\n  }\n')),(0,i.mdx)("admonition",{type:"note"},(0,i.mdx)("p",{parentName:"admonition"},"We chose not to introduce ",(0,i.mdx)("inlineCode",{parentName:"p"},'"android"')," and ",(0,i.mdx)("inlineCode",{parentName:"p"},'"ios"')," conditions, due to the prevalence of other existing platform selection methods, and the complexity of how this behavior might work across frameworks. We recommend the ",(0,i.mdx)("a",{parentName:"p",href:"https://reactnative.dev/docs/platform#select"},(0,i.mdx)("inlineCode",{parentName:"a"},"Platform.select()"))," API instead.")),(0,i.mdx)("h3",{id:"replacing-platform-specific-extensions"},"Replacing platform-specific extensions"),(0,i.mdx)("blockquote",null,(0,i.mdx)("p",{parentName:"blockquote"},(0,i.mdx)("strong",{parentName:"p"},"Breaking change"),": Subpaths matched in ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," (including via ",(0,i.mdx)("a",{parentName:"p",href:"https://nodejs.org/docs/latest-v19.x/api/packages.html#subpath-patterns"},"subpath patterns"),") will use the exact file path specified by a package, and will not attempt to expand ",(0,i.mdx)("inlineCode",{parentName:"p"},"sourceExts")," or platform-specific extensions.")),(0,i.mdx)("h4",{id:"use-platformselect-react-native"},"Use ",(0,i.mdx)("a",{parentName:"h4",href:"https://reactnative.dev/docs/platform#select"},(0,i.mdx)("inlineCode",{parentName:"a"},"Platform.select()"))," (React Native)"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'  "exports": {\n    "./FooComponent": "./src/FooComponent.js"\n  }\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"// src/FooComponent.js\n\nconst FooComponent = Platform.select({\n  android: require('./FooComponentAndroid.js'),\n  ios: require('FooComponentIOS.js'),\n});\n\nexport default FooComponent;\n")),(0,i.mdx)("h3",{id:"asset-files"},"Asset files"),(0,i.mdx)("p",null,"As with source files, assets must be listed in ",(0,i.mdx)("inlineCode",{parentName:"p"},'"exports"')," to be imported without warnings. Asset files with ",(0,i.mdx)("a",{parentName:"p",href:"/docs/configuration#assetresolutions"},"multiple densities"),", e.g. ",(0,i.mdx)("inlineCode",{parentName:"p"},"icon.png")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"icon@2x.png"),", will continue to work without being listed individually."),(0,i.mdx)("p",null,"Using subpath patterns can be a convenient method to export many assets. We recommend specifying asset subpaths ",(0,i.mdx)("strong",{parentName:"p"},"with their file extension"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "exports": {\n    "./assets/*.png": "./dist/assets/*.png"\n  }\n}\n')))}x.isMDXComponent=!0}}]);