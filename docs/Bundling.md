---
id: bundling
title: Bundling
---

When bundling, each of the modules gets assigned a numeric id, meaning no dynamic requires are supported. Requires are changed by its numeric version, and modules are stored in different possible formats. Three different formats of bundling are supported:

打包时，每个模块都会分配一个数字id做为该模块的唯一id，Requires are changed by its numeric version。Bundle支持如下三种格式：

## Plain bundle

这是标准的Bundle格式。这个js bundle文件里其实存的是一个自执行函数,参数是一个数组，包含我们所有的模块。这对于期望仅使用JS的包（例如浏览器）的环境非常有用。只需要将`http://localhost:8081/index.js?dev=true&platform=web`中入口文件的的后缀换成`.bundle`就可以触发它的构建

## Indexed RAM bundle

此格式将包打成二级制文件，主要包括以下几部分(所有数据均以Little Endian表示)

* 一组数字: 值为`0xFB0BD1E5`, 它是`uint32`类型并且放在文件的开头，用于做文件的验证
* 一个偏移表： 带有标题和一系列的`unit32`序列对
    * 标题：有两个`uint32`类型的值，分别指表的长度和startup code的长度
    * 序列对： 代表文件中的偏移量和code module的长度(以字节为单位)
* 对于每个模块以空字节(`\0`)结尾

```
` 0                   1                   2                   3                   4                   5                   6
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Magic number                         |                          Header size                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Startup code size                       |                        Module 0 offset                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Module 0 length                        |                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                                                               +
|                                                                                                                               |
+                                                              ...                                                              +
|                                                                                                                               |
+                                                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |                        Module n offset                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Module n length                        | Module 0 code | Module 0 code |      ...      |       \0      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Module 1 code | Module 1 code |      ...      |       \0      |                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                                                               +
|                                                                                                                               |
+                                                              ...                                                              +
|                                                                                                                               |
+                                                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               | Module n code | Module n code |      ...      |       \0      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+`
```
这个结构最适合能够一次加载内存中所有代码的环境

* 通过使用偏移表，可以在恒定的时间内加载任何模块，其中模块`x`的代码位于`file[(x + 3) * sizeof(uint32)]`。由于存在分隔所有模块的空字符(`\0`),通常可以不需要使用长度，并且模块可以直接作为ASCIIZ字符串加载
* 启动代码总是在`file[sizeof(uint32)]`

这种打包通常用在iOS中

## File RAM bundle

每个模块都单独存储并且命令为`js-modules/${id}.js`，另外还创建了一个`UNBUNDLE`文件，内容仅有一个数字`0xFB0BD1E5`。**`UNBUNDLE`文件是在根目录下创建的**。

这种打包方式通常用在android中，因为包内容是压缩的，对于压缩文件的访问要快得多，如果使用`Indexed RAM bundle`，则应立即解压缩所有捆绑的内容以获取相应模块的代码